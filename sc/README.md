# Supply Chain Tracker â€“ Smart contracts

This folder contains the Foundry workspace for the Supply Chain Tracker protocol. The main contract mints ERC-1155 tokens that represent batches of goods and enforces the role-based transfer flow used by the web application.

## Requirements

* [Foundry](https://book.getfoundry.sh/getting-started/installation) (`forge`, `cast`, `anvil`).
* A recent version of Rust (installed automatically by Foundry).

## Environment setup

Copy the relevant section from the repository-wide `.env.example` into `sc/.env.local` and fill in the values:

```bash
cp ../.env.example .env.local
```

Common variables:

| Variable | Purpose |
| --- | --- |
| `MNEMONIC` | Deterministic mnemonic for local development. |
| `DERIVATION_PATH` | HD path used by the deploy script. |
| `SEED`, `SEED_CHAINS`, `SEED_LOTS_PER_CHAIN`, `SEED_TRANSFERS_PER_STAGE` | Controls the amount of sample data generated by the deployment scripts. |

## Commands

```bash
forge install        # fetch dependencies listed in foundry.toml
forge build          # compile the contracts
forge test           # run the test suite
forge snapshot       # capture gas costs (optional)
```

Start a local node with:

```bash
anvil --mnemonic "$(cat .env.local | grep MNEMONIC | cut -d'=' -f2 | tr -d '"')"
```

## Deployment helpers

Deployment and seeding scripts live under [`script/`](script/). The default entry point is `SupplyChainTracker.s.sol` which:

1. Deploys the registry contract.
2. Registers demo accounts for each role.
3. Seeds example tokens and transfers so the dashboard has data immediately.

Execute it with:

```bash
forge script script/SupplyChainTracker.s.sol --rpc-url <RPC_URL> --broadcast --legacy
```

Replace `<RPC_URL>` with your Anvil or remote node endpoint. Add `--mnemonic "${MNEMONIC}"` if you want to reuse the deterministic accounts from your `.env.local` file.

## Testing strategy

Unit and integration tests live in [`test/`](test/). Every new contract or storage change should include:

* Permission checks for each role.
* Event assertions to keep the subgraph in sync.
* Reverts for malformed transfers or role requests.

Run `forge test --gas-report` before merging changes to keep an eye on gas costs.

